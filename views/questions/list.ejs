<%- include ../layouts/header.ejs %>
<script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>

<% if (messages.error) { %>
	<p style="color:red"><%- messages.error %></p>
<% } %>

<% if (messages.success) { %>
	<p style="color:green"><%- messages.success %></p>
<% } %>	

<table class="table table-hover">
	<thead >
		<tr>
     	<th scope="col">Query</th>
	  	<th scope="col">Response</th>
   		<th scope="col">Select Existing Intent</th>
   		<th scope="col">Enter New Intent</th>
  		<th scope="col">Action</th>
	  </tr>
  </thead>
	<tbody>
		<% if (data) { %>
			<% data.forEach(function(question){ %>
				<tr>
					<span><input type="hidden" name="que_id" id="que_id" value="<%= question.id%>"></span>
					<td><%= question.question %></td>
					<td><%= question.answer %></td>
					<td>
		    		<select class="selectpicker" name="intent" id="select_int-<%= question.id%>">  
			      	<ul>
				        <option value="">Select Intent</option>
				        <% intent_details.forEach((intent) => { %>
				         	<% if( intent["name"] == question.intent){ %>
									  <option value="<%= intent["id"]%>" selected="selected"><%= intent["name"] %></option>
									 <% } else{ %>  
									    <option value="<%= intent["id"]%>"><%= intent["name"] %></option>
									<% } %>				         
				        <% }) %>
				      </ul>
		    		</select>
   				</td>
   				<td>
   					<% if(question.intent){ %>
							<input type="text" class="form-control new_int-" name="intent" id="intent-<%= question.id%>" value="<%= question.intent %>" disabled/>
						 <% } else{ %>  
						  <input type="text" class="form-control new_int-" name="intent" id="intent-<%= question.id%>"/>
						<% } %>							
					</td>
					<% if(req.session.user[0].user_role == "Change Manager"){ %>
						<td><button  class="btn btn-info" id="<%= question.id %>" value="<%= question.intent%>">Create Intent</button></td>
					 <% } else{ %>  
					  <td><button  class="btn btn-info" id="<%= question.id %>" value="<%= question.intent%>" disabled>Create Intent</button></td>
					<% } %>											
				</tr>
			<% }) %>
		<% } %>
	</tbody>
</table>

<%- include ../layouts/footer.ejs %>

<script>
$(document).ready(function(){
	$("button").on("click", function () {
		var que_id = $(this).attr('id');
		var intent = $('#intent-'+ que_id).val();
		var sel_int =$("#select_int-"+ que_id +" :selected").text();
		var sel_int_id = $('#select_int-'+ que_id).val();
		$.ajax({
	    url : 'questions/add/intent',
	    type : 'POST',
	    data : {
	        'intent' : intent,
	        'que_id' :	que_id,
	        'intent_id' : sel_int_id
	    },
	    success : function(data) {              
	      alert("Successfully Intent Created");
	      window.location.reload();
	    },
	    error : function(request,error)
	    {
	    	console.log("error");
	      alert("Something went wrong");
	    }
		});
	});
});
</script>


